<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø–ª–∞—Ç–∞</title>
    <style>
        .payment-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .card-group {
            display: flex;
            gap: 10px;
        }

        .card-group input {
            flex: 1;
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
        }

        .success {
            color: #28a745;
            text-align: center;
            padding: 10px;
        }

        .loading {
            text-align: center;
            padding: 10px;
        }
        .back-btn {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .back-btn:hover {
            background: #5a6268;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã */
        .card-valid {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
        }

        .card-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        }

        .card-validation-message {
            margin-top: 5px;
            font-size: 13px;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .card-valid-message {
            color: #155724;
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }

        .card-invalid-message {
            color: #721c24;
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
<div class="payment-form">
    <h2>–û–ø–ª–∞—Ç–∞</h2>

    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å -->
    <div th:if="${error}"
         style="color: #dc3545; padding: 15px; background: #f8d7da;
                border-radius: 5px; margin-bottom: 20px;">
        ‚ùå <span th:text="${error}"></span>
    </div>

    <form id="paymentForm" th:action="@{/payment-form/otp}" method="post">
        <div class="form-group">
            <label for="cardholderName">–í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã</label>
            <input type="text" id="cardholderName" name="cardholderName"
                   placeholder="IVANOV IVAN"
                   th:value="${cardholderName}"
                   style="text-transform: uppercase;"
                   required>
            <small style="color: #6c757d; display: block; margin-top: 5px;">
                –í–≤–µ–¥–∏—Ç–µ –∫–∞–∫ –Ω–∞ –∫–∞—Ä—Ç–µ (—Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–µ–¥–µ—Ç –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã)
            </small>
            <div id="nameError" style="color: #dc3545; font-size: 12px; margin-top: 5px;"></div>
        </div>


        <div class="form-group">
            <label for="amount">–°—É–º–º–∞</label>
            <input type="number" id="amount" name="amount" step="0.01" th:value="${amount}" readonly>
        </div>

        <div class="form-group">
            <label for="purpose">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</label>
            <input type="text" id="purpose" name="purpose" th:value="${purpose}" readonly>
        </div>

        <div class="form-group">
            <label for="cardNumber">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
            <input type="text" id="cardNumber" name="cardNumber"
                   placeholder="0000 0000 0000 0000"
                   maxlength="19" th:value="${cardNumber}" required>
            <div id="cardValidationMessage" class="card-validation-message" style="display: none;"></div>
            <small style="color: #6c757d; display: block; margin-top: 5px;">
                –í–≤–µ–¥–∏—Ç–µ 16 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
            </small>
        </div>

        <div class="card-group">
            <div class="form-group">
                <label for="expiryDate">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                <input type="text" id="expiryDate"  name="expiryDate" placeholder="–ú–ú/–ì–ì"
                       maxlength="5" th:value="${expiryDate}" required>

            </div>

            <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="password" id="cvv" name="cvv" placeholder="000"
                       maxlength="3" th:value="${cvv}" required>
            </div>
        </div>

        <div class="form-group">
            <label for="email">Email –¥–ª—è —á–µ–∫–∞</label>
            <input type="email" id="email" name="email"
                   placeholder="your@email.com"
                   th:value="${email}" required>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
            –û–ø–ª–∞—Ç–∏—Ç—å
        </button>
    </form>
<!--
    <button type="button"
            class="back-btn"
            onclick="window.location.href='/'">
        –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
    </button>
-->
    <div id="resultMessage">
        <div th:if="${paymentStatus} == 'success'"
             style="color: green; padding: 15px; background: #d4edda; border-radius: 5px; margin-top: 15px;">
            <h3>‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω</h3>
            <p th:text="'ID –æ–ø–µ—Ä–∞—Ü–∏–∏: ' + ${paymentOperationId}"></p>
            <p th:text="${paymentMessage}"></p>
        </div>

        <div th:if="${paymentStatus} == 'error'"
             style="color: red; padding: 15px; background: #f8d7da; border-radius: 5px; margin-top: 15px;">
            <h3>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞</h3>
            <p th:text="${paymentMessage}"></p>
        </div>
    </div>
</div>

<script src="payment-widget.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('paymentForm');
        const nameInput = document.getElementById('cardholderName'); // –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
        const submitBtn = document.getElementById('submitBtn');
        const resultDiv = document.getElementById('resultMessage');

        // ============ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô CAPS –î–õ–Ø –ò–ú–ï–ù–ò ============
        if (nameInput) {
            // 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –ø—Ä–∏ –≤–≤–æ–¥–µ
            nameInput.addEventListener('input', function(e) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
                const cursorPosition = this.selectionStart;
                // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
                this.value = this.value.toUpperCase();
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
                this.setSelectionRange(cursorPosition, cursorPosition);
            });

            // 2. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–≤–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ CAPS
            if (nameInput.value) {
                nameInput.value = nameInput.value.toUpperCase();
            }
        }

        // ============ –ê–õ–ì–û–†–ò–¢–ú –õ–£–ù–ê –í JavaScript ============
        function isValidLuhn(cardNumber) {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
            const cleanNumber = cardNumber.replace(/\D/g, '');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
            if (cleanNumber.length < 13 || cleanNumber.length > 19) {
                return false;
            }

            let sum = 0;
            let isEven = false;

            // –ò–¥–µ–º —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
            for (let i = cleanNumber.length - 1; i >= 0; i--) {
                let digit = parseInt(cleanNumber.charAt(i), 10);

                if (isEven) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9; // –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Å–ª–æ–∂–µ–Ω–∏—é —Ü–∏—Ñ—Ä
                    }
                }

                sum += digit;
                isEven = !isEven;
            }

            return (sum % 10 === 0);
        }

        function updateCardValidationUI(cardNumber) {
            const cardInput = document.getElementById('cardNumber');
            const validationMsg = document.getElementById('cardValidationMessage');

            if (!cardNumber || cardNumber.replace(/\s/g, '').length < 13) {
                // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π, —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                validationMsg.style.display = 'none';
                cardInput.classList.remove('card-valid', 'card-invalid');
                return;
            }

            const isValid = isValidLuhn(cardNumber);

            if (isValid) {
                cardInput.classList.remove('card-invalid');
                cardInput.classList.add('card-valid');
                validationMsg.innerHTML = '<span style="color: #28a745;">‚úì –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –≤–∞–ª–∏–¥–µ–Ω</span>';
                validationMsg.className = 'card-validation-message card-valid-message';
                validationMsg.style.display = 'block';
            } else {
                cardInput.classList.remove('card-valid');
                cardInput.classList.add('card-invalid');
                validationMsg.innerHTML = '<span style="color: #dc3545;">‚úó –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞.</span>';
                validationMsg.className = 'card-validation-message card-invalid-message';
                validationMsg.style.display = 'block';
            }
        }
        // ============ –ö–û–ù–ï–¶ –ê–õ–ì–û–†–ò–¢–ú–ê –õ–£–ù–ê ============

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
            value = value.replace(/(\d{4})/g, '$1 ').trim();
            e.target.value = value.substring(0, 19);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –õ—É–Ω–∞
            updateCardValidationUI(value);
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
        document.getElementById('expiryDate').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value.substring(0, 5);
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã (–ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
        nameInput?.addEventListener('blur', function() {
            const value = this.value.trim().toUpperCase(); // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º CAPS
            const errorDiv = document.getElementById('nameError') ||
                            (() => {
                                const div = document.createElement('div');
                                div.id = 'nameError';
                                div.style.cssText = 'color:#dc3545;margin-top:5px;font-size:14px;';
                                this.parentNode.appendChild(div);
                                return div;
                            })();

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –ø—Ä–æ–±–µ–ª—ã)
            this.value = value;

            if (!value) {
                errorDiv.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã';
                this.style.borderColor = '#dc3545';
            } else if (/[–∞-—è–ê-–Ø—ë–Å]/.test(value)) {
                errorDiv.textContent = '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ';
                this.style.borderColor = '#dc3545';
            } else if (value.split(/\s+/).filter(w => w.length > 0).length < 2) {
                errorDiv.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: IVANOV IVAN)';
                this.style.borderColor = '#dc3545';
            } else {
                errorDiv.textContent = '';
                this.style.borderColor = '#28a745';
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            const cardNumber = document.getElementById('cardNumber').value;
            const cleanCardNumber = cardNumber.replace(/\s/g, '');

            // 1. –§–∏–∫—Å–∏—Ä—É–µ–º –∏–º—è –≤ CAPS –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
            if (nameInput) {
                nameInput.value = nameInput.value.toUpperCase().trim();
                const cardholderName = nameInput.value;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞
                if (!cardholderName) {
                    e.preventDefault();
                    alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã');
                    nameInput.focus();
                    return false;
                }

                if (/[–∞-—è–ê-–Ø—ë–Å]/.test(cardholderName)) {
                    e.preventDefault();
                    alert('–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏.');
                    nameInput.focus();
                    return false;
                }

                if (cardholderName.split(/\s+/).filter(w => w.length > 0).length < 2) {
                    e.preventDefault();
                    alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: IVANOV IVAN)');
                    nameInput.focus();
                    return false;
                }
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –õ—É–Ω–∞
            if (cleanCardNumber.length >= 13 && !isValidLuhn(cardNumber)) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫—É.');
                document.getElementById('cardNumber').focus();
                return false;
            }

            return true;
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å
        const initialCardNumber = document.getElementById('cardNumber').value;
        if (initialCardNumber) {
            updateCardValidationUI(initialCardNumber);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å
        if (nameInput && nameInput.value) {
            nameInput.value = nameInput.value.toUpperCase();
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
            nameInput.dispatchEvent(new Event('blur'));
        }
    });
</script>
<script>
    // –î–û–ë–ê–í–¨ –ü–ï–†–ï–î –≠–¢–û–ô –°–¢–†–û–ö–û–ô: </body>
    // ============================

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –≤–≤–æ–¥–µ
    (function() {
        'use strict';

        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCardDetection);
        } else {
            initCardDetection();
        }

        function initCardDetection() {
            const cardInput = document.getElementById('cardNumber');
            if (!cardInput) return;

            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã
            const previewContainer = document.createElement('div');
            previewContainer.id = 'cardTypePreview';
            previewContainer.style.cssText = `
                margin-top: 8px;
                padding: 10px 15px;
                border-radius: 6px;
                background: #f8f9fa;
                display: none;
                align-items: center;
                gap: 12px;
                border-left: 4px solid transparent;
                transition: all 0.3s ease;
                font-size: 14px;
            `;

            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–æ–ª—è –∫–∞—Ä—Ç—ã
            cardInput.parentNode.appendChild(previewContainer);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞
            cardInput.addEventListener('input', handleCardInput);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
            if (cardInput.value.trim()) {
                handleCardInput({ target: cardInput });
            }
        }

        function handleCardInput(event) {
            const input = event.target;
            const preview = document.getElementById('cardTypePreview');
            const cardNumber = input.value.replace(/\s/g, '');

            if (!cardNumber) {
                preview.style.display = 'none';
                return;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–∞—Ä—Ç—ã
            const cardType = detectCardType(cardNumber);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
            preview.innerHTML = `
                <div style="font-size: 24px; color: ${cardType.color}; min-width: 40px; text-align: center;">
                    ${cardType.icon}
                </div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 600; color: ${cardType.color}; font-size: 16px;">
                        ${cardType.name}
                    </div>
                    <div style="font-size: 13px; color: #666; margin-top: 2px;">
                        ${cardNumber.length >= 4 ? `‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ${cardNumber.slice(-4)}` : '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã'}
                    </div>
                </div>
            `;

            preview.style.display = 'flex';
            preview.style.borderLeftColor = cardType.color;
            preview.style.boxShadow = `0 2px 4px ${cardType.color}20`;
        }

        function detectCardType(cardNumber) {
            if (!cardNumber || cardNumber.length === 0) {
                return {
                    name: '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã',
                    icon: 'üí≥',
                    color: '#6c757d'
                };
            }

            const firstDigit = cardNumber[0];

            if (firstDigit === '4') {
                return {
                    name: 'Visa',
                    icon: 'üí≥',
                    color: '#1a1f71',
                    description: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞'
                };
            } else if (firstDigit === '5') {
                return {
                    name: 'MasterCard',
                    icon: 'üí≥',
                    color: '#eb001b',
                    description: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞'
                };
            } else if (firstDigit === '2') {
                return {
                    name: '–ú–ò–†',
                    icon: 'üá∑üá∫',
                    color: '#1e5f9a',
                    description: '–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –†–æ—Å—Å–∏–∏'
                };
            } else {
                return {
                    name: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞',
                    icon: 'üí≥',
                    color: '#6c757d',
                    description: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã'
                };
            }
        }
    })();

    // –£–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    document.addEventListener('DOMContentLoaded', function() {
        const originalHandler = document.getElementById('cardNumber').oninput;

        document.getElementById('cardNumber').addEventListener('input', function(e) {
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
            if (originalHandler) originalHandler.call(this, e);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã
            const event = new Event('input', { bubbles: true });
            this.dispatchEvent(event);
        });
    });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–≤—å—é —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã */
    #cardTypePreview i {
        font-size: 24px;
    }
</style>

</body>
</html>